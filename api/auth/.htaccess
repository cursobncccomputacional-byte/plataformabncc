# Permitir execução de PHP
<IfModule mod_php.c>
  php_flag engine on
</IfModule>

# Permitir acesso aos arquivos PHP
<FilesMatch "\.php$">
  SetHandler application/x-httpd-php
</FilesMatch>

# Rewrite: /api/auth/login -> /api/auth/login.php
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /api/auth/
  
  # Se a requisição não termina com .php e o arquivo .php existe, redirecionar
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME}.php -f
  RewriteRule ^([^/]+)/?$ $1.php [L]
  
  # Se a requisição é exatamente "login", "logout" ou "me", adicionar .php
  RewriteRule ^(login|logout|me)$ $1.php [L]
</IfModule>

# Headers CORS
<IfModule mod_headers.c>
  # IMPORTANTE:
  # Com credentials (cookies), NÃO pode usar Access-Control-Allow-Origin: *
  # Aqui refletimos a origem apenas para origens permitidas.
  SetEnvIfNoCase Origin "^https://(cursos\.novaedubncc\.com\.br|novaedubncc\.com\.br|www\.novaedubncc\.com\.br)$" ACAO=$0

  Header always set Access-Control-Allow-Origin "%{ACAO}e" env=ACAO
  Header always set Access-Control-Allow-Credentials "true" env=ACAO
  Header always set Vary "Origin" env=ACAO

  Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
  Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, X-Session-ID, X-User-Id, X-User-Role"
</IfModule>
